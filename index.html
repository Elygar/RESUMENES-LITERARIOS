<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RESÚMENES LITERARIOS - Audiolibros y Resúmenes</title>
  <meta name="description" content="Colección de resúmenes en video y audiolibros organizados por género. Reproduce, explora y descubre obras literarias." />
  <link rel="icon" href="favicon.ico" />

  <style>
    :root{--primary:#5e35b1;--dark:#311b92;}
    *{box-sizing:border-box;}
    body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;margin:0;background:#f4f1fa;color:#333;display:flex;flex-direction:column;min-height:100vh}
    header{background:linear-gradient(90deg,var(--primary),var(--dark));color:#fff;padding:18px;text-align:center;position:relative}
    header h1{margin:0;font-size:1.6rem}
    .menu-btn{position:absolute;left:14px;top:10px;cursor:pointer;width:44px;height:44px}
    .menu-btn img{width:100%;height:100%;object-fit:contain}
    .search-container{display:flex;justify-content:center;align-items:center;gap:10px;padding:14px;flex-wrap:wrap}
    .search-container input{width:100%;max-width:420px;padding:10px 14px;border-radius:22px;border:1px solid #ccc;font-size:14px;min-width:200px}
    .search-container button{padding:10px 16px;border-radius:22px;border:none;background:var(--primary);color:#fff;cursor:pointer;white-space:nowrap}
    .search-container button:disabled{opacity:.6;cursor:not-allowed}
    main{flex:1;width:100%}
    .wrap{max-width:1200px;margin:0 auto;padding:10px;width:100%}
    .content{display:grid;grid-template-columns:1fr;gap:10px}
    .video-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;padding:18px}
    .card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.08);transition:transform .18s}
    .card:hover{transform:translateY(-6px)}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .card .card-content{padding:12px}
    .card h3{margin:0;font-size:1rem;color:var(--dark);word-wrap:break-word}
    .card p{margin:6px 0;font-size:.9rem;color:#333;word-wrap:break-word}
    .btn{display:inline-block;padding:8px 14px;border-radius:18px;border:none;background:var(--primary);color:#fff;cursor:pointer}
    .btn.secondary{background:#666}
    .pagination{display:flex;gap:8px;justify-content:center;align-items:center;padding:12px;flex-wrap:wrap}
    .pagination button{padding:8px 12px;border-radius:18px;border:none;background:var(--primary);color:#fff;cursor:pointer;font-size:14px}
    .pagination button:disabled{background:#bdbdbd;cursor:not-allowed}
    .page-info{font-size:.95rem;color:#444;margin:0 8px}
    #noResults{display:none;text-align:center;padding:40px;color:#666;font-size:1.1rem}
    
    .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:2000;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
    .overlay .box{width:100%;max-width:980px;background:#111;border-radius:12px;overflow:hidden;color:#fff;margin:auto;position:relative}
    .overlay iframe{width:100%;height:480px;border:0;display:block}
    .close-btn{position:absolute;right:10px;top:10px;background:crimson;color:white;border:none;border-radius:50%;width:36px;height:36px;cursor:pointer;z-index:2200;font-size:18px}
    .video-info{padding:18px;background:#111;border-bottom:1px solid #222}
    .video-info h2{margin:0 0 8px;font-size:1.4rem;word-wrap:break-word}
    .video-info .author{color:#bbb;margin-bottom:8px}
    .video-info .synopsis{color:#ddd;line-height:1.5;word-wrap:break-word}
    .video-tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .video-tag{background:var(--primary);padding:6px 10px;border-radius:14px;font-size:.85rem;cursor:pointer;border:none;color:#fff}
    .related-videos{padding:16px;background:#0f0f0f}
    .related-videos h3{margin:0 0 10px;font-size:1.2rem}
    .related-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
    .related-card{display:block;background:#222;border-radius:8px;overflow:hidden;cursor:pointer;color:#fff;text-decoration:none}
    .related-card img{width:100%;height:90px;object-fit:cover;display:block}
    .related-card .meta{padding:8px;font-size:.9rem;color:#ddd;word-wrap:break-word}
    
    .sidebar{position:fixed;left:-300px;top:0;height:100%;width:260px;background:var(--dark);color:#fff;padding:18px;transition:left .25s;z-index:2100;overflow:auto}
    .sidebar.active{left:0}
    .sidebar h3{text-align:center;margin:0 0 12px;font-size:1.2rem}
    .genre-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .genre-tag{border:1px solid rgba(255,255,255,.2);padding:8px 10px;border-radius:12px;cursor:pointer;font-size:.85rem;text-transform:uppercase;background:transparent;color:#fff}
    .genre-tag.active{background:#fff;color:var(--dark);border-color:#fff}
    .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:2050}
    .sidebar-overlay.show{display:block}
    footer{background:var(--dark);color:#fff;text-align:center;padding:12px;font-size:14px}

    /* Responsive */
    @media(max-width:768px){
      header h1{font-size:1.3rem;padding-right:50px}
      .search-container{padding:10px}
      .search-container input{width:calc(100% - 100px);min-width:150px}
      .video-list{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;padding:12px}
      .overlay .box{margin:10px;max-height:95vh;overflow-y:auto}
      .overlay iframe{height:260px}
      .video-info{padding:14px}
      .video-info h2{font-size:1.2rem}
      .related-grid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
      .pagination{gap:6px;padding:10px}
      .pagination button{padding:6px 10px;font-size:13px}
      .page-info{font-size:.85rem}
      .close-btn{right:8px;top:8px;width:32px;height:32px;font-size:16px}
    }

    @media(max-width:480px){
      header h1{font-size:1.1rem}
      .search-container input{width:calc(100% - 90px);font-size:13px}
      .search-container button{padding:8px 12px;font-size:13px}
      .video-list{grid-template-columns:1fr;padding:10px}
      .card img{height:200px}
      .overlay iframe{height:220px}
      .video-info h2{font-size:1.1rem}
      .related-grid{grid-template-columns:repeat(2,1fr);gap:8px}
      .pagination button{padding:6px 8px;font-size:12px}
      .sidebar{width:240px;left:-240px}
    }

    @media(min-width:1400px){
      .video-list{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
    }
  </style>
</head>
<body>

  <header>
    <h1>RESÚMENES LITERARIOS</h1>
    <div class="menu-btn" id="menuBtn" onclick="toggleMenu()">
      <img src="favicon.png" alt="Menú">
    </div>
  </header>

  <div class="sidebar" id="sidebar" aria-hidden="true">
    <h3>GÉNEROS</h3>
    <div id="genreList" class="genre-tags" aria-label="Lista de géneros"></div>
  </div>
  <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleMenu()"></div>

  <main>
    <div class="wrap">
      <div class="search-container" role="search">
        <input id="searchInput" type="text" placeholder="Buscar por título, autor o sinopsis..." aria-label="Buscar">
        <button id="searchBtn" onclick="buscar()">Buscar</button>
      </div>

      <div id="noResults">Página no encontrada.</div>

      <section class="video-list" id="videoList" aria-live="polite"></section>

      <div class="pagination" id="paginationBar" role="navigation" aria-label="Paginación"></div>
    </div>
  </main>

  <div class="overlay" id="videoOverlay" role="dialog" aria-modal="true" onclick="closeOverlayOnBackground(event)">
    <div class="box" onclick="event.stopPropagation()">
      <button class="close-btn" onclick="closeOverlay()">✖</button>
      <div id="playerWrap">
        <iframe id="playerFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
      <div class="video-info" id="videoInfo"></div>
      <div class="related-videos" id="relatedVideos"></div>
    </div>
  </div>

  <footer><small>&copy; 2025 Audiolibros - Resúmenes en Video de Obras Literarias</small></footer>

<script>
let videos = [];
let listaActual = [];
let currentPage = 1;
const itemsPerPage = 12;

fetch('videos.json?t=' + Date.now())
  .then(r => r.json())
  .then(data => {
    videos = Array.isArray(data) ? data : [];
    listaActual = videos.slice();
    cargarGeneros();
    mostrarPagina(1);
  })
  .catch(err => {
    console.error('Error cargando videos.json', err);
    document.getElementById('noResults').textContent = 'Error cargando contenido.';
    document.getElementById('noResults').style.display = 'block';
  });

function mostrarPagina(page){
  const listEl = document.getElementById('videoList');
  const noResEl = document.getElementById('noResults');
  listEl.innerHTML = '';
  noResEl.style.display = 'none';

  if (!Array.isArray(listaActual) || listaActual.length === 0) {
    noResEl.style.display = 'block';
    renderPaginacion(0);
    return;
  }

  const totalPages = Math.max(1, Math.ceil(listaActual.length / itemsPerPage));
  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;
  currentPage = page;

  const start = (currentPage - 1) * itemsPerPage;
  const slice = listaActual.slice(start, start + itemsPerPage);

  const frag = document.createDocumentFragment();
  slice.forEach(v => {
    const art = document.createElement('article');
    art.className = 'card';
    art.innerHTML = `
      <img loading="lazy" src="https://img.youtube.com/vi/${v.id}/hqdefault.jpg" alt="${escapeHtml(v.titulo)}">
      <div class="card-content">
        <h3>${escapeHtml(v.titulo)}</h3>
        <p><strong>Autor:</strong> ${escapeHtml(v.autor)}</p>
        <p title="${escapeHtml(v.sinopsis)}">${escapeHtml(truncate(v.sinopsis,120))}</p>
        <button class="btn" onclick="openOverlay('${v.id}')">Ver más</button>
      </div>`;
    frag.appendChild(art);
  });
  listEl.appendChild(frag);
  renderPaginacion(Math.ceil(listaActual.length / itemsPerPage));
  window.scrollTo({top:0, behavior:'smooth'});
}

function renderPaginacion(totalPages) {
  const p = document.getElementById('paginationBar');
  p.innerHTML = '';
  if (totalPages === 0) return;

  const btnInicio = document.createElement('button');
  btnInicio.textContent = 'Inicio';
  btnInicio.disabled = currentPage === 1;
  btnInicio.onclick = () => mostrarPagina(1);
  p.appendChild(btnInicio);

  const btnPrev = document.createElement('button');
  btnPrev.textContent = 'Anterior';
  btnPrev.disabled = currentPage === 1;
  btnPrev.onclick = () => mostrarPagina(currentPage - 1);
  p.appendChild(btnPrev);

  const info = document.createElement('span');
  info.className = 'page-info';
  info.textContent = `Página ${currentPage} de ${totalPages}`;
  p.appendChild(info);

  const btnNext = document.createElement('button');
  btnNext.textContent = 'Siguiente';
  btnNext.disabled = currentPage === totalPages;
  btnNext.onclick = () => mostrarPagina(currentPage + 1);
  p.appendChild(btnNext);
}

document.getElementById('searchInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    buscar();
  }
});

function buscar(){
  const texto = document.getElementById('searchInput').value.toLowerCase().trim();
  if (!texto){
    listaActual = videos.slice();
    mostrarPagina(1);
    return;
  }
  listaActual = videos.filter(v => 
    (v.titulo && v.titulo.toLowerCase().includes(texto)) ||
    (v.autor && v.autor.toLowerCase().includes(texto)) ||
    (v.sinopsis && v.sinopsis.toLowerCase().includes(texto)) ||
    (v.genero && v.genero.toLowerCase().includes(texto))
  );
  mostrarPagina(1);
}

function cargarGeneros(){
  const cont = document.getElementById('genreList');
  cont.innerHTML = '';

  const setG = new Set();
  videos.forEach(v => {
    if (!v.genero) return;
    v.genero.split(',').forEach(g => {
      const gg = g.trim();
      if (gg) setG.add(gg);
    });
  });

  const todos = document.createElement('div');
  todos.className = 'genre-tag active';
  todos.textContent = 'TODOS';
  todos.onclick = () => {
    document.querySelectorAll('.genre-tag').forEach(t=>t.classList.remove('active'));
    todos.classList.add('active');
    listaActual = videos.slice();
    mostrarPagina(1);
    if (window.innerWidth <= 768) toggleMenu();
  };
  cont.appendChild(todos);

  [...setG].sort((a,b)=>a.localeCompare(b,'es')).forEach(g => {
    const el = document.createElement('div');
    el.className = 'genre-tag';
    el.textContent = g;
    el.onclick = () => {
      document.querySelectorAll('.genre-tag').forEach(t=>t.classList.remove('active'));
      el.classList.add('active');
      const key = g.toLowerCase();
      listaActual = videos.filter(v => v.genero && v.genero.toLowerCase().includes(key));
      mostrarPagina(1);
      if (window.innerWidth <= 768) toggleMenu();
    };
    cont.appendChild(el);
  });
}

function openOverlay(videoId){
  const v = videos.find(x => x.id === videoId);
  if (!v) return;
  const overlay = document.getElementById('videoOverlay');
  const iframe = document.getElementById('playerFrame');
  iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
  overlay.style.display = 'flex';
  document.body.style.overflow = 'hidden';
  mostrarInfoVideo(v);
  mostrarVideosRelacionados(v);
}

function closeOverlay(){
  document.getElementById('videoOverlay').style.display = 'none';
  document.body.style.overflow = '';
  const iframe = document.getElementById('playerFrame');
  iframe.src = '';
  document.getElementById('videoInfo').innerHTML = '';
  document.getElementById('relatedVideos').innerHTML = '';
}

function closeOverlayOnBackground(e){
  if(e.target.id === 'videoOverlay') closeOverlay();
}

function mostrarInfoVideo(video){
  const cont = document.getElementById('videoInfo');
  const generos = (video.genero || '').split(',').map(s=>s.trim()).filter(Boolean);
  const tagsHtml = generos.map(g => `<button class="video-tag" onclick="filterFromTag('${escapeJs(g)}')">${escapeHtml(g)}</button>`).join(' ');
  cont.innerHTML = `
    <h2>${escapeHtml(video.titulo)}</h2>
    <div class="author"><strong>Autor:</strong> ${escapeHtml(video.autor)}</div>
    <div class="synopsis">${escapeHtml(video.sinopsis)}</div>
    <div class="video-tags">${tagsHtml}</div>
  `;
}

function filterFromTag(g){
  closeOverlay();
  const el = [...document.querySelectorAll('.genre-tag')].find(x => x.textContent.toLowerCase() === g.toLowerCase());
  if (el){
    el.click();
  } else {
    listaActual = videos.filter(v => v.genero && v.genero.toLowerCase().includes(g.toLowerCase()));
    document.querySelectorAll('.genre-tag').forEach(t=>t.classList.remove('active'));
    mostrarPagina(1);
  }
}

function mostrarVideosRelacionados(videoActual){
  const container = document.getElementById('relatedVideos');
  container.innerHTML = '';
  const genAct = (videoActual.genero || '').toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
  let relacionados = videos.filter(v => {
    if (v.id === videoActual.id) return false;
    const genV = (v.genero || '').toLowerCase().split(',').map(s=>s.trim());
    return genAct.some(g => genV.includes(g));
  });

  if (relacionados.length < 4) {
    const otros = videos.filter(v => v.id !== videoActual.id && !relacionados.includes(v));
    relacionados = relacionados.concat(otros);
  }

  relacionados = relacionados.sort(()=>Math.random()-0.5).slice(0,4);

  if (relacionados.length === 0) return;
  const title = document.createElement('h3');
  title.textContent = 'Videos Relacionados';
  const grid = document.createElement('div');
  grid.className = 'related-grid';

  relacionados.forEach(rv => {
    const card = document.createElement('a');
    card.className = 'related-card';
    card.onclick = (e) => { e.preventDefault(); openOverlay(rv.id); };
    card.innerHTML = `
      <img src="https://img.youtube.com/vi/${rv.id}/hqdefault.jpg" alt="${escapeHtml(rv.titulo)}">
      <div class="meta"><strong>${escapeHtml(rv.titulo)}</strong><div style="color:#aaa;font-size:.85rem">${escapeHtml(rv.autor)}</div></div>
    `;
    grid.appendChild(card);
  });

  container.appendChild(title);
  container.appendChild(grid);
}

function toggleMenu(){
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  const isActive = sidebar.classList.toggle('active');
  overlay.classList.toggle('show', isActive);
  if(isActive) document.body.style.overflow = 'hidden';
  else document.body.style.overflow = '';
}

function escapeHtml(str = '') {
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function escapeJs(str=''){ return String(str).replace(/'/g,"\\'"); }
function truncate(s, n=120){ return s && s.length>n ? s.slice(0,n-1)+'…' : (s||''); }
</script>
</body>
</html>
