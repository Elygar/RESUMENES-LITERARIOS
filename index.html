<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audiolibros y Resúmenes Literarios</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f4f1fa; color: #333; display: flex; flex-direction: column; min-height: 100vh; }
    header { background: linear-gradient(90deg, #5e35b1, #311b92); color: white; padding: 20px; text-align: center; position: relative; }
    .menu-btn { position: absolute; left: 20px; top: 10px; cursor: pointer; z-index: 100; width: 45px; height: 45px; }
    .menu-btn img { width: 100%; height: 100%; object-fit: contain; }
    .search-container { text-align: center; margin: 20px; }
    .search-container input { width: 90%; max-width: 500px; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .video-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: auto; }
    .card { background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; transition: transform 0.2s ease; }
    .card:hover { transform: translateY(-5px); }
    .card img { width: 100%; height: 180px; object-fit: cover; }
    .card-content { padding: 15px; }
    .btn { margin-top: 10px; padding: 8px 16px; background: #5e35b1; color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: background 0.2s ease; }
    .btn:hover { background: #311b92; }
    .sidebar { position: fixed; top: 0; left: -290px; width: 250px; height: 100%; background: #311b92; color: white; padding: 20px; transition: left 0.3s ease; z-index: 1200; overflow-y: auto; }
    .sidebar.active { left: 0; }
    .genre-tag { border: 1px solid white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; text-transform: uppercase; margin: 3px; transition: all 0.2s ease; }
    .genre-tag:hover, .genre-tag.active { background: white; color: #311b92; }
    footer { background: #311b92; color: white; text-align: center; padding: 15px; margin-top: auto; }
  </style>
</head>
<body>
  <header>
    <h1>RESÚMENES LITERARIOS</h1>
    <div class="menu-btn" onclick="toggleMenu()">
      <img src="favicon.png" alt="Menú">
    </div>
  </header>

  <main>
    <div class="search-container">
      <input type="search" id="searchInput" placeholder="Buscar por título, autor o sinopsis..." autocomplete="off" onkeypress="return event.key !== 'Enter'">
    </div>
    <section class="video-list" id="videoList"></section>
    <nav id="pagination"></nav>
  </main>

  <aside class="sidebar" id="sidebar">
    <h4><center>GÉNEROS</center></h4>
    <div id="genreList" class="genre-tags"></div>
  </aside>

  <footer><p>&copy; 2025 Audiolibros</p></footer>

  <script>
    let videos = [];
    let currentPage = 1;
    const itemsPerPage = 30;

    fetch('videos.json?t=' + new Date().getTime())
      .then(r => r.json())
      .then(data => {
        videos = data;
        mostrarPagina(1);
        cargarGeneros();
      });

    // Render progresivo para evitar congelamiento
    function renderizarVideos(lista, container) {
      return new Promise(resolve => {
        container.innerHTML = "";
        const total = lista.length;
        let index = 0;
        const chunk = 10; // cantidad de videos por lote

        function renderChunk() {
          const fragment = document.createDocumentFragment();
          for (let i = 0; i < chunk && index < total; i++, index++) {
            const video = lista[index];
            const card = document.createElement('article');
            card.className = "card";
            card.innerHTML = `
              <img src="https://img.youtube.com/vi/${video.id}/hqdefault.jpg" alt="${video.titulo}">
              <div class="card-content">
                <h3>${video.titulo}</h3>
                <p><strong>Autor:</strong> ${video.autor}</p>
                <p>${video.sinopsis}</p>
                <button class="btn" onclick="openOverlay('${video.id}')">Ver más</button>
              </div>`;
            fragment.appendChild(card);
          }
          container.appendChild(fragment);
          if (index < total) requestAnimationFrame(renderChunk);
          else resolve();
        }
        requestAnimationFrame(renderChunk);
      });
    }

    async function mostrarPagina(page) {
      currentPage = page;
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginaVideos = videos.slice(start, end);
      const lista = document.getElementById("videoList");
      await renderizarVideos(paginaVideos, lista);
    }

    function toggleMenu() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    function cargarGeneros() {
      const contenedor = document.getElementById("genreList");
      contenedor.innerHTML = "";
      const tagTodos = document.createElement("div");
      tagTodos.textContent = "TODOS";
      tagTodos.className = "genre-tag";
      tagTodos.onclick = () => filterGenre("all", tagTodos);
      contenedor.appendChild(tagTodos);

      const generos = new Set();
      videos.forEach(v => v.genero.split(",").forEach(g => generos.add(g.trim().toUpperCase())));
      [...generos].sort().forEach(g => {
        const tag = document.createElement("div");
        tag.textContent = g;
        tag.className = "genre-tag";
        tag.onclick = () => filterGenre(g.toLowerCase(), tag);
        contenedor.appendChild(tag);
      });
    }

    async function filterGenre(genre, el) {
      document.querySelectorAll(".genre-tag").forEach(tag => tag.classList.remove("active"));
      if (el) el.classList.add("active");

      const lista = document.getElementById("videoList");
      if (genre === "all") {
        await mostrarPagina(1);
      } else {
        const filtrados = videos.filter(v => v.genero.toLowerCase().includes(genre));
        await renderizarVideos(filtrados, lista);
      }

      if (window.innerWidth <= 768) toggleMenu();
    }

    document.getElementById('searchInput').addEventListener('input', async e => {
      const filter = e.target.value.toLowerCase().trim();
      const lista = document.getElementById("videoList");
      if (!filter) {
        await mostrarPagina(1);
        return;
      }
      const filtrados = videos.filter(v =>
        v.titulo.toLowerCase().includes(filter) ||
        v.autor.toLowerCase().includes(filter) ||
        v.sinopsis.toLowerCase().includes(filter)
      );
      await renderizarVideos(filtrados, lista);
    });
  </script>
</body>
</html>
